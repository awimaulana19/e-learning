<div
  class="modal fade text-left"
  id="default"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel1"
  aria-hidden="true"
>
  <form enctype="multipart/form-data" action="/guru/mapel" method="POST">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="myModalLabel1">Tambah Data</h5>
          <button
            type="button"
            class="close rounded-pill"
            data-bs-dismiss="modal"
            aria-label="Close"
          >
            <i data-feather="x"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="nama" class="form-label">Nama Pertemuan</label>
            <input
              type="text"
              class="form-control"
              name="nama"
              id="nama"
              required
            />
          </div>
          <div class="mb-3">
            <label for="deskripsi" class="form-label"
              >Deskripsi (Opsional)</label
            >
            <textarea
              class="form-control"
              name="deskripsi"
              id="deskripsi"
              cols="30"
              rows="5"
            ></textarea>
          </div>
          <div class="mb-3">
            <div class="mb-2 d-flex justify-content-between">
              <label for="nama_resource" class="form-label me-2">Materi </label>
              <div class="d-flex">
                <button
                  type="button"
                  id="tambahMateri"
                  class="badge bg-primary d-flex justify-content-center align-items-center me-2 border-0"
                  onclick="tambahInputMateri()"
                >
                  <i class="fas fa-plus-square"></i>
                </button>
                <button
                  type="button"
                  id="bersihkanMateri"
                  class="badge bg-danger d-flex justify-content-center align-items-center border-0"
                  onclick="bersihkanSemuaMateri()"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </div>
          </div>
          <div id="materiContainer"></div>
          <div class="mb-3">
            <div class="mb-2 d-flex justify-content-between">
              <label for="kehadiran" class="form-label me-2">Presensi</label>
              <div class="d-flex">
                <button
                  type="button"
                  id="tambahKehadiran"
                  class="badge bg-primary d-flex justify-content-center align-items-center me-2 border-0"
                  onclick="tambahInputKehadiran()"
                >
                  <i class="fas fa-plus-square"></i>
                </button>
                <button
                  type="button"
                  id="bersihkanKehadiran"
                  class="badge bg-danger d-flex justify-content-center align-items-center border-0"
                  onclick="bersihkanSemuaKehadiran()"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </div>
          </div>
          <div id="kehadiranContainer"></div>
          <div class="mb-3">
            <div class="mb-2 d-flex justify-content-between">
              <label for="nama_tugas" class="form-label me-2">Tugas</label>
              <div class="d-flex">
                <button
                  type="button"
                  id="tambahTugas"
                  class="badge bg-primary d-flex justify-content-center align-items-center me-2 border-0"
                  onclick="tambahInputTugas()"
                >
                  <i class="fas fa-plus-square"></i>
                </button>
                <button
                  type="button"
                  id="bersihkanTugas"
                  class="badge bg-danger d-flex justify-content-center align-items-center border-0"
                  onclick="bersihkanSemuaTugas()"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </div>
          </div>
          <div id="tugasContainer"></div>
          <input type="hidden" name="mapel" value="<%= mapel._id %>" />
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-danger d-flex justify-content-center align-items-center"
            data-bs-dismiss="modal"
          >
            Batal
          </button>
          <button
            type="submit"
            class="btn btn-primary d-flex justify-content-center align-items-center"
          >
            Tambah
          </button>
        </div>
      </div>
    </div>
  </form>
</div>

<script>
  function tambahInputMateri() {
    var materiContainer = document.getElementById("materiContainer");

    var outerDiv = document.createElement("div");
    outerDiv.classList.add("mb-3");

    var div2 = document.createElement("div");
    div2.classList.add("mb-3");

    var label2 = document.createElement("label");
    label2.setAttribute("for", "nama_resource");
    label2.classList.add("form-label");
    label2.innerText = "Nama Materi";

    var input2 = document.createElement("input");
    input2.setAttribute("type", "text");
    input2.classList.add("form-control", "resource-input");
    input2.setAttribute("name", "nama_resource");
    input2.setAttribute("id", "nama_resource");
    input2.setAttribute("required", "true");

    div2.appendChild(label2);
    div2.appendChild(input2);

    var innerDiv = document.createElement("div");
    innerDiv.classList.add(
      "d-flex",
      "justify-content-between",
      "align-items-center"
    );

    var label = document.createElement("label");
    label.setAttribute("for", "file");
    label.classList.add("form-label");
    label.innerText = "Materi";

    var switchDiv = document.createElement("div");
    switchDiv.classList.add("form-check", "form-switch");

    var switchInput = document.createElement("input");
    switchInput.classList.add("form-check-input", "mb-1");
    switchInput.setAttribute("type", "checkbox");
    switchInput.setAttribute("id", "flexSwitchCheckDefault");
    switchInput.setAttribute("onchange", "updateLabel(this)");

    var switchLabel = document.createElement("label");
    switchLabel.classList.add("form-check-label");
    switchLabel.setAttribute("for", "flexSwitchCheckDefault");
    switchLabel.innerText = "File";

    switchDiv.appendChild(switchInput);
    switchDiv.appendChild(switchLabel);

    innerDiv.appendChild(label);
    innerDiv.appendChild(switchDiv);

    outerDiv.appendChild(div2);
    outerDiv.appendChild(innerDiv);

    var fileInput = document.createElement("input");
    fileInput.setAttribute("type", "file");
    fileInput.classList.add("form-control", "file-input");
    fileInput.setAttribute("name", "file");
    fileInput.setAttribute("id", "file");
    fileInput.setAttribute("required", "true");

    outerDiv.appendChild(fileInput);

    materiContainer.appendChild(outerDiv);
  }

  function bersihkanSemuaMateri() {
    var materiContainer = document.getElementById("materiContainer");
    materiContainer.innerHTML = "";
  }

  var isTugasAdded = false;

  function tambahInputTugas() {
    if (isTugasAdded) {
      return;
    }

    var tugasContainer = document.getElementById("tugasContainer");

    var div1 = document.createElement("div");
    div1.classList.add("mb-3");

    var label1 = document.createElement("label");
    label1.setAttribute("for", "nama_tugas");
    label1.classList.add("form-label");
    label1.innerText = "Nama Tugas";

    var input1 = document.createElement("input");
    input1.setAttribute("type", "text");
    input1.classList.add("form-control");
    input1.setAttribute("name", "nama_tugas");
    input1.setAttribute("id", "nama_tugas");
    input1.setAttribute("required", "true");

    div1.appendChild(label1);
    div1.appendChild(input1);

    var div2 = document.createElement("div");
    div2.classList.add("mb-3");

    var label2 = document.createElement("label");
    label2.setAttribute("for", "tugas");
    label2.classList.add("form-label");
    label2.innerText = "Tugas";

    var textarea = document.createElement("textarea");
    textarea.classList.add("form-control");
    textarea.setAttribute("name", "tugas");
    textarea.setAttribute("id", "tugas");
    textarea.setAttribute("cols", "30");
    textarea.setAttribute("rows", "5");
    textarea.setAttribute("required", "true");

    div2.appendChild(label2);
    div2.appendChild(textarea);

    var div3 = document.createElement("div");
    div3.classList.add("mb-3");

    var label3 = document.createElement("label");
    label3.setAttribute("for", "file_tugas");
    label3.classList.add("form-label");
    label3.innerText = "File Tugas (Opsional)";

    var input3 = document.createElement("input");
    input3.setAttribute("type", "file");
    input3.classList.add("form-control");
    input3.setAttribute("name", "file_tugas");
    input3.setAttribute("id", "file_tugas");

    div3.appendChild(label3);
    div3.appendChild(input3);

    var div4 = document.createElement("div");
    div4.classList.add("mb-3");

    var label4 = document.createElement("label");
    label4.setAttribute("for", "batas_tanggal");
    label4.classList.add("form-label");
    label4.innerText = "Batas Waktu";

    var div4Row = document.createElement("div");
    div4Row.classList.add("row");

    var div4Col1 = document.createElement("div");
    div4Col1.classList.add("col-6");

    var input4Date = document.createElement("input");
    input4Date.setAttribute("type", "date");
    input4Date.classList.add("form-control");
    input4Date.setAttribute("name", "batas_tanggal");
    input4Date.setAttribute("id", "batas_tanggal");
    input4Date.setAttribute("required", "true");

    div4Col1.appendChild(input4Date);

    var div4Col2 = document.createElement("div");
    div4Col2.classList.add("col-6");

    var input4Time = document.createElement("input");
    input4Time.setAttribute("type", "time");
    input4Time.classList.add("form-control");
    input4Time.setAttribute("name", "batas_jam");
    input4Time.setAttribute("id", "batas_jam");
    input4Time.setAttribute("required", "true");

    div4Col2.appendChild(input4Time);

    div4Row.appendChild(div4Col1);
    div4Row.appendChild(div4Col2);

    div4.appendChild(label4);
    div4.appendChild(div4Row);

    tugasContainer.appendChild(div1);
    tugasContainer.appendChild(div2);
    tugasContainer.appendChild(div3);
    tugasContainer.appendChild(div4);

    isTugasAdded = true;
  }

  function bersihkanSemuaTugas() {
    var tugasContainer = document.getElementById("tugasContainer");
    tugasContainer.innerHTML = "";
    isTugasAdded = false;
  }

  var isKehadiranAdded = false;

  function tambahInputKehadiran() {
    if (isKehadiranAdded) {
      return;
    }

    var kehadiranContainer = document.getElementById("kehadiranContainer");

    var div1 = document.createElement("div");
    div1.classList.add("mb-3");

    var label1 = document.createElement("label");
    label1.setAttribute("for", "password_absensi");
    label1.classList.add("form-label");
    label1.innerText = "Password Presensi";

    var input1 = document.createElement("input");
    input1.setAttribute("type", "text");
    input1.classList.add("form-control");
    input1.setAttribute("name", "password_absensi");
    input1.setAttribute("id", "password_absensi");
    input1.setAttribute("required", "true");

    div1.appendChild(label1);
    div1.appendChild(input1);

    var div2 = document.createElement("div");
    div2.classList.add("mb-3");

    var label2 = document.createElement("label");
    label2.setAttribute("for", "deskripsi_absensi");
    label2.classList.add("form-label");
    label2.innerText = "Deskripsi (Opsional)";

    var textarea = document.createElement("textarea");
    textarea.classList.add("form-control");
    textarea.setAttribute("name", "deskripsi_absensi");
    textarea.setAttribute("id", "deskripsi_absensi");
    textarea.setAttribute("cols", "30");
    textarea.setAttribute("rows", "5");

    div2.appendChild(label2);
    div2.appendChild(textarea);

    var div3 = document.createElement("div");
    div3.classList.add("mb-3");

    var label3 = document.createElement("label");
    label3.setAttribute("for", "batas_tanggalAbsensi");
    label3.classList.add("form-label");
    label3.innerText = "Waktu Presensi";

    var div3Row = document.createElement("div");
    div3Row.classList.add("row");

    var div3Col1 = document.createElement("div");
    div3Col1.classList.add("col-6");

    var input3Date = document.createElement("input");
    input3Date.setAttribute("type", "date");
    input3Date.classList.add("form-control");
    input3Date.setAttribute("name", "batas_tanggalAbsensi");
    input3Date.setAttribute("id", "batas_tanggalAbsensi");
    input3Date.setAttribute("required", "true");

    div3Col1.appendChild(input3Date);

    var div3Col2 = document.createElement("div");
    div3Col2.classList.add("col-6");

    var input3Time = document.createElement("input");
    input3Time.setAttribute("type", "time");
    input3Time.classList.add("form-control");
    input3Time.setAttribute("name", "jam_absen");
    input3Time.setAttribute("id", "jam_absen");
    input3Time.setAttribute("required", "true");

    div3Col2.appendChild(input3Time);

    div3Row.appendChild(div3Col1);
    div3Row.appendChild(div3Col2);

    div3.appendChild(label3);
    div3.appendChild(div3Row);

    var div4 = document.createElement("div");
    div4.classList.add("mb-3");

    var label4 = document.createElement("label");
    label4.setAttribute("for", "batas_jamAbsensi");
    label4.classList.add("form-label");
    label4.innerText = "Batas Presensi";

    var input4 = document.createElement("input");
    input4.setAttribute("type", "time");
    input4.classList.add("form-control");
    input4.setAttribute("name", "batas_jamAbsensi");
    input4.setAttribute("id", "batas_jamAbsensi");
    input4.setAttribute("required", "true");

    div4.appendChild(label4);
    div4.appendChild(input4);

    kehadiranContainer.appendChild(div1);
    kehadiranContainer.appendChild(div2);
    kehadiranContainer.appendChild(div3);
    kehadiranContainer.appendChild(div4);

    isKehadiranAdded = true;
  }

  function bersihkanSemuaKehadiran() {
    var kehadiranContainer = document.getElementById("kehadiranContainer");
    kehadiranContainer.innerHTML = "";
    isKehadiranAdded = false;
  }

  function updateLabel(checkbox) {
    var label = checkbox.nextElementSibling;
    var resourceInput = checkbox
      .closest(".mb-3")
      .querySelector(".resource-input");
    var fileInput = checkbox.closest(".mb-3").querySelector(".file-input");

    if (checkbox.checked) {
      label.innerHTML = "Link";
      fileInput.setAttribute("name", "link");
      fileInput.setAttribute("type", "text");
      fileInput.setAttribute("placeholder", "Masukkan Link");
      resourceInput.setAttribute("name", "nama_link");
      fileInput.setAttribute("pattern", "https?://.+");
      fileInput.setAttribute(
        "title",
        "Masukkan link yang valid (dimulai dengan http:// atau https://)"
      );
    } else {
      label.innerHTML = "File";
      fileInput.setAttribute("name", "file");
      fileInput.setAttribute("type", "file");
      fileInput.removeAttribute("placeholder");
      resourceInput.setAttribute("name", "nama_resource");
      fileInput.removeAttribute("pattern");
      fileInput.removeAttribute("title");
    }
  }
</script>
